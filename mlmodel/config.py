"""Глобальные настройки пайплайна."""

# ===== количество дней обучения / теста =====
TRAINING = {
    "train_days": 29,  # дней в обучающем окне основного пайплайна
    "test_days": 1,  # дней в онлайн-окне (для прогонки детектора)
}

DETECTOR = {
    "use_quantile_corridor": False,
    "q_low": 0.05,
    "q_high": 0.95,
    # Гейт по низким потокам: не тревожим, если оба канала < этого порога
    "min_flow_m3h": 0.2,
}


# ===== единицы измерения / пересчёт =====
UNITS = {
    "itp_xvs_factor": 1.0,
    "odpu_gvs_factor": 1.0,
    "supply_factor": 1.0,
    "return_factor": 1.0,
}

# ===== пороги качества и баланса =====
THRESHOLDS = {
    "rel_diff_limit": 0.10,  # |GVS - XVS| / max(GVS, XVS) > 10%
    "zero_anomaly_hours": 2,  # подряд часов нулей для аномалии
    "spike_iqr_k": 3.0,  # всплеск: |x - median| > k * IQR
    "flatline_hours": 6,  # одинаковое значение подряд >= 6 часов
}

# ===== онлайн-детектор =====
ONLINE = {
    "zdelta_alarm": 3.0,
    "zratio_alarm": 3.5,
    "min_abs_delta_m3": 0.15,
    # posterior_alarm оставлен для совместимости; «unknown» мы больше не используем
    "posterior_alarm": 0.6,
    "prior": {
        "normal": 0.70,
        "leak": 0.10,
        "odpu_fault": 0.06,
        "itp_fault": 0.06,
        "tamper": 0.04,
        "tech": 0.04,
    },
    # Гистерезис (вход/выход) и "severe"
    "zdelta_enter": 3.0,
    "zdelta_exit": 2.5,
    "zratio_enter": 3.5,
    "zratio_exit": 3.0,
    "z_severe": 5.0,  # одиночный час тревожим, если |z| ≥ z_severe
}

# ===== русские подписи причин и интерпретация правил =====
RU_CAUSE = {
    "normal": "Норма",
    "leak": "Утечка",
    "odpu_fault": "Неисправность ОДПУ",
    "itp_fault": "Неисправность ИТП",
    "tamper": "Вмешательство",
    "tech": "Техпроцесс",
}

RU_RULE = {
    "normal": "Отклонения в пределах ожидаемых, z-оценки малы.",
    "leak": "XVS > GVS (положительный Δ), низкое GVS/XVS, без нулевых/плоских участков.",
    "odpu_fault": "Плоские/нулевые показания ГВС, большой положительный Δ.",
    "itp_fault": "Плоские/нулевые показания ХВС, отрицательный Δ.",
    "tamper": "Подозрительно высокий GVS/XVS без плоских участков.",
    "tech": "Рециркуляция (Подача>Обратка) или низкий ΔT + всплеск ХВС.",
}

# ===== инциденты =====
INCIDENTS = {
    # единый параметр длительности: и для пост-фильтра аномалий, и для инцидентов
    "min_duration_h": 4,
}

# ===== оформление единственного графика =====
PLOT = {
    "daily_bars_figsize": (12, 4),  # размер фигуры 03_daily_bars.png
    "no_data_figsize": (10, 4),
    "dpi": 150,
}
